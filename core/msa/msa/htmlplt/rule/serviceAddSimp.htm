<HTML>
<HEAD>
<TITLE>网络7层管理和过滤的领导者</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK rel=stylesheet type=text/css href="/msa/publiccss/pubcss.css">
<LINK rel=stylesheet type=text/css href="/msa/extjs/resources/css/ext-all.css">
<link rel="stylesheet" type="text/css" href="/msa/extjs/resources/css/feed-viewer.css" />
<LINK rel=stylesheet type=text/css href="/msa/extjs/resources/css/xtheme-default.css" id="xthemecss" >
<script type="text/javascript" src="/msa/extjs/adapter/ext/ext-base.js"></script>
<SCRIPT type=text/javascript  src="/msa/extjs/ext-all.js"></SCRIPT>
<script type=text/javascript  src="/msa/publicjs/select_time_st.js"></script>
<script type=text/javascript  src="/msa/publicjs/exportexcel.js"></script>
<STYLE type=text/css>
HTML {
	BORDER-BOTTOM: 0px;
	BORDER-LEFT: 0px;
	PADDING-BOTTOM: 0px;
	MARGIN: 0px;
	PADDING-LEFT: 0px;
	PADDING-RIGHT: 0px;
	FONT: 12px verdana;
	HEIGHT: 100%;
	OVERFLOW: hidden;
	BORDER-TOP: 0px;
	BORDER-RIGHT: 0px;
	PADDING-TOP: 0px
}
BODY {
	BORDER-BOTTOM: 0px;
	BORDER-LEFT: 0px;
	PADDING-BOTTOM: 0px;
	MARGIN: 0px;
	PADDING-LEFT: 0px;
	PADDING-RIGHT: 0px;
	FONT: 12px verdana;
	HEIGHT: 100%;
	OVERFLOW: hidden;
	BORDER-TOP: 0px;
	BORDER-RIGHT: 0px;
	PADDING-TOP: 0px
}
P {
	MARGIN: 5px
}
.STYLE1 {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
}
</STYLE>
<SCRIPT type=text/javascript>
    Ext.BLANK_IMAGE_URL = '/msa/extjs/resources/images/default/s.gif';
		var xtzystore;
		var ruleid;
    Ext.onReady(function(){
		Ext.QuickTips.init();
		var detailEl;
		var myMask = new Ext.LoadMask(Ext.getBody(),
		    {
		        	msg:"Please wait..."
		    });
		myMask.show();
		var servicebutton= Ext.get('addService');
		servicebutton.on('click', function(){
			  if(userform.rulename.value=="" ){
					Ext.MessageBox.alert("提示","规则名称不能为空!");
					userform.rulename.focus();
					return;
				}
				Ext.Ajax.request({
          method : 'POST',
          url:'/msa/main.xp',
          success: function(response, options){
          	ruleid=response.responseText;
						parent.store.load();
						//parent.menufrm.location.href='/msa/main.xp?Fun=showEditService&sid='+ ruleid;
						parent.menufrm.location.href='/msa/main.xp?Fun=showRuleSrvSimp&sid='+ ruleid;						
						//parent.addwin.close();
          },
          failure : function(){
          	Ext.MessageBox.alert("提示","添加失败!");
						parent.store.load();
          },
          params:{Fun:'addService',ruleflag:userform.ruleflag.value,logaction:userform.logaction.value,conaction:userform.conaction.value,ruleschedule:userform.ruleschedule.value,rulejjr:userform.rulejjr.value,rulename:userform.rulename.value,ruleurl:userform.ruleurl.value,policy:userform.policy.value,group:userform.group.value}
				});
		});
//		//部门
//		var groupwin;
//		var groupbutton= Ext.get('applygroup');
//		groupbutton.on('click', function(){
//		if(!groupwin){
//								var grouptree=new Ext.tree.TreePanel({
//									    	  id: 'gtree-panel',
//									        region:'center',
//									        split: true,
//									        useArrows:true,
//									        autoScroll: true,
//									        rootVisible: false,
//									        lines: false,
//									        useArrows: true,
//									        loader: new Ext.tree.TreeLoader({
//									        	  dataUrl:'/msa/main.xp?Fun=msaGroupTree',
//															baseParams:{Fun:'msaGroupTree',type:'4'}
//									        }),
//									        root: new Ext.tree.AsyncTreeNode(),
//									        listeners:{
//							            "checkchange": function(node, state) {
//							                if (node.parentNode != null) {
//							                    //子节点选中
//							                    node.cascade(function(node){
//							                        node.attributes.checked = state;
//							                        node.ui.checkbox.checked = state;
//							                        return true;
//							                    });
//							                    //父节点选中
//							                    var pNode = node.parentNode;
//							                    if (state || grouptree.getChecked(id, pNode) == "") {
//							                        pNode.ui.toggleCheck(state);
//							                        pNode.attributes.checked = state;
//							                    }
//							                }
//							            }
//        								}
//								 });
//								var groupwin = new Ext.Window({
//								layout      : 'fit',
//                title: '设置管理部门',
//                width       : 500,
//                height      : 300,
//                closeAction :'hide',
//                plain       : true,
//                items       : grouptree,
//								buttons: [{
//                    text     : '保存选择的部门',
//                    handler  : function(){
//                       groupmanager ="0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       groupmanager =groupmanager + "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                       var selNodes = grouptree.getChecked();
//				               Ext.each(selNodes, function(node){
//				                    if(node.id=='0'){
//				                      groupmanager = '1' + groupmanager.substring(Number(node.id)+1);
//				                    }else if(node.id=='999'){
//				                      groupmanager = groupmanager.substring(0,Number(node.id)) +  '1';
//				                    }else{
//				                      groupmanager = groupmanager.substring(0,Number(node.id)) +  '1' + groupmanager.substring(Number(node.id)+1,1000);
//				                    }
//				                });
//				                document.getElementById('group').value=groupmanager;
//				                groupwin.hide();
//                    }
//                },{
//                    text     : '选择全部部门',
//                    handler  : function(){
//                        groupmanager ="1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        groupmanager =groupmanager + "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111";
//                        document.getElementById('group').value=groupmanager;
//                        groupwin.hide();
//                    }
//                }]
//							});
//		}
//		groupwin.show();
//		});
//    //策略
//    var policywin;
//		var plicybutton= Ext.get('applypolicy');
//		plicybutton.on('click', function(){
//		if(!policywin){
//		var policytree=new Ext.tree.TreePanel({
//				renderTo:Ext.getBody(),
//				height:300,
//				split: true,
//				useArrows:true,
//				autoScroll: true,
//				rootVisible: false,
//				lines: false,
//				useArrows: true,
//				root: {
//		            nodeType: 'async'
//		        },
//		    loader: new Ext.tree.TreeLoader({
//						dataUrl:'/msa/main.xp?Fun=msaPolicyTree',
//						baseParams:{Fun:'msaPolicyTree',type:'2'}
//				})
//	 	});
//		policywin = new Ext.Window({
//				title: '选择所属策略',
//				closeAction: 'hide',
//				width: 500,
//				height:300,
//				plain:true,
//				items:policytree,
//				bodyStyle:'padding:5px;',
//				buttons:[{
//		                text     : '保存选择的策略',
//		                handler  : function(){
//		                seled="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//		                var selNodes = policytree.getChecked();
//				                Ext.each(selNodes, function(node){
//				                    if(node.id=='0'){
//				                      seled = '1' + seled.substring(node.id);
//				                    }else if(node.id=='127'){
//				                      seled = seled.substring(0,node.id) +  '1';
//				                    }else{
//				                      seled = seled.substring(0,node.id) +  '1' + seled.substring(node.id,127);
//				                    }
//				                });
//												document.getElementById('policy').value=seled;
//					    					policywin.hide();
//                    }
//                },{
//                    text     : '选择全部',
//                    handler  : function(){
//                    var rootNodes = policytree.getRootNode();
//                		if (rootNodes.childNodes && rootNodes.childNodes.length>0)
//                        {
//												var child;
//												seled="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//                        for (var i=0;i<rootNodes.childNodes.length;i++){
//                            child = rootNodes.childNodes[i];
//                            if(i=='0'){
//				                      seled = '1' + seled.substring(i);
//				                    }else if(i=='127'){
//				                      seled = seled.substring(0,i) +  '1';
//				                    }else{
//				                      seled = seled.substring(0,i) +  '1' + seled.substring(i,127);
//				                    }
//                            child.getUI().toggleCheck(true);
//                        }}
//                        document.getElementById('policy').value=seled;
//                        policywin.hide();
//                    }
//                }]
//			});
//		}
//		policywin.show();
//		});
	  new Ext.Viewport({
					layout: 'border',
					items: [{
						region:'center',
						layout:'fit',
	          split:false,
	          minSize: 100,
	          maxSize: 300,
	          frame:false,
	          collapsible:true,
	          autoScroll: true,
	          margins:'0 0 0 0',
	          contentEl:'mainviewdiv'
	         }
					],
	        renderTo: Ext.getBody()
	  });
		myMask.hide();
});
	</SCRIPT>
</HEAD>
<body oncontextmenu="return true" topmargin=0 leftmargin=0 style="SCROLLBAR-FACE-COLOR: #f0f0f0;  overflow-x:hidden;  OVERFLOW: scroll; SCROLLBAR-SHADOW-COLOR: #f0f0f0; SCROLLBAR-3DLIGHT-COLOR: #f0f0f0; SCROLLBAR-ARROW-COLOR: #f0f0f0; SCROLLBAR-DARKSHADOW-COLOR: #cccccc;" >
<div id="mainviewdiv" valign="top" align="center" STYLE="position:absolute; top=20; left=30; z-index:1;">
	<table width="100%" height=70% cellpadding=0 cellspacing=0 Border=0>
		<form name="userform" method="POST">
			<input type="hidden" name="group" value="0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000">
			<input type="hidden" name="policy" value="0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000">
			<INPUT TYPE='hidden'  class=input   NAME="ruleurl" VALUE="" >
			<INPUT type="hidden" class="inputself0" id="logaction" value="1">
			<INPUT type="hidden" class="inputself0" id="conaction" value="1">
			<INPUT type="hidden" class="inputself0" id="rulejjr" value="1">
			<!-- generic wizard buttons -->
			<tr>
				<td colspan = 2 align="left">
					<TABLE CELLPADDING = 3 CELLSPACING=0 >
						<tr>
							<td><span class="STYLE1">新建访问规则</span></td>
						</tr>
						<TR>
							<TD width="235" VALIGN='middle'><FONT FACE='宋体' >名称： </font></TD>
							<TD width="457" VALIGN='middle'>
								<INPUT TYPE='text'  class=input   NAME="rulename" VALUE="" >
							</TD>
						</TR>
						<TR>
							<TD VALIGN='middle'><FONT FACE='宋体' >启用： </font></TD>
							<TD VALIGN='middle'>
								<select name="ruleflag" class="inputself0" id="ruleflag">
									<option value="0">不启用</option>
									<option value="1" selected>启用</option>
								</select>
							</TD>
						</TR>
						<TR>
							<TD VALIGN='middle'> 规则应用的时间</TD>
							<td>
								<select name="ruleschedule" class="inputself0" id="ruleschedule">
									<option value="0">全部时间</option>
									[$begintable schlist$]
									<option value="[$schid$]" >[$schname$]</option>
									[$endtable$]
								</select>
							</td>
						</TR>
						<TR>
					<!--	<TR>
							<TD>
								<INPUT TYPE='Button' NAME="applygroup" class=input value="选择部门">
							</TD>
							<TD>
								<INPUT TYPE='Button' NAME="applypolicy" class=input value="选择策略">
							</TD>
							<TD>
							</TD>
						</TR> -->
					</table>
				</td>
			</tr>
			<tr>
				<td colspan ="2">
					<hr/>
				</td>
			<tr>
				<td colspan ="2" align="left">
					<input type="BUTTON" NAME="addService" class=buttons value="下一步",>
				</td>
			</tr>
		</form>
	</TABLE>
</div>
</BODY>
</HTML>
